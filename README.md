# 🧭 AURC & 이탈률 계산기 _ aurc_calc_v5.py

## 🎯 목적
고객(학생)의 **이탈 시점과 잔존 유지력**을 분석하고,  
“어디서 가장 많이 이탈하는가?”  
“어디를 개선하면 유지력이 늘어나는가?”  
를 시뮬레이션할 수 있는 대시보드입니다.

이번 버전에서는  
👉 **전이효과(Spillover)** 개념을 반영하여  
**“앞 구간 개선이 뒤 구간에 미치는 영향”** 까지 고려한 시나리오 분석이 가능해졌습니다.

---

## ⚙️ 1. 주요 기능

| 기능 | 설명 |
|------|------|
| **이탈률(Churn Rate)** | 실제 DM(구간)별 이탈률 계산 (결제→매칭→첫수업 등 단계별) |
| **AURC (Retention Curve)** | Kaplan–Meier(KM) 방식으로 평균 유지개월(AURC) 계산 |
| **ΔAURC 계산** | 개선 시나리오 적용 후 평균 유지개월 증가량 |
| **Spillover ON/OFF** | 앞 구간 개선의 연쇄효과(전이효과) 반영 여부를 선택 |
| **시나리오 비교 시각화** | 현재 vs 개선 후 생존곡선 및 ΔAURC 비교 그래프 |
| **Expander 도움말** | 전이효과 개념 및 활용 가이드 내장 |

---

## 📘 전이효과(Spillover)란?

앞 단계(M1)의 개선이 뒤 단계(M2·M3)의 고객 잔존에도 영향을 주는 **연쇄 효과**입니다.  
예를 들어, 첫달(M1) 이탈을 줄이면 더 많은 학생이 M2 구간으로 넘어가게 됩니다.

| 모드 | 의미 | 활용 목적 |
|------|------|-----------|
| **OFF (기본)** | 각 구간(M1, M2, M3)을 독립적으로 계산 | 팀별 KPI / 구간별 개선 목표 설정 |
| **ON** | 앞 구간 개선의 영향이 뒤 구간 잔존률에도 반영 | 전체 유지력(AURC) / ΔAURC 시나리오 분석 |

💡 **요약**  
- OFF → "각 구간의 개선효과"를 **직관적으로 비교**  
- ON → "전체 고객 잔존기간"을 **시스템 관점으로 평가**

---

## 🧮 예시 시나리오

| 구간 | 개선율 | 현재 이탈률 | TO-BE (ON) | TO-BE (OFF) |
|------|--------|--------------|--------------|--------------|
| M1 | 15%↓ | 30.0% | 25.5% | 25.5% |
| M2 | 5%↓ | 7.0% | **7.1%** | 6.65% |
| M3 | 5%↓ | 5.0% | 4.9% | 4.75% |

- **전이효과 ON:** M1 개선 → M2 진입 인원 증가 → 절대 손실률이 커질 수 있음  
- **전이효과 OFF:** 각 구간 독립 계산 → 입력한 개선율만큼 정확히 감소  

---

## 🧩 탭 구성 요약

### ① 이탈률 (Churn Rate)
- DM(1~4) 구간별 실제 이탈률 계산  
- 단계별 구성요소(매칭 전·후, 첫수업 전/후 등) 분석  
- `reactiveornot != "T"` 고객 기준  

### ② AURC (KM 기반 생존분석)
- Kaplan–Meier 생존곡선으로 전체 잔존률 추정  
- 코호트별 비교(1/3/6/12개월)  
- AURC(평균 유지개월)과 ΔAURC(개선효과) 계산  
- **Spillover ON/OFF 토글 제공**

---

## 📈 개선 시나리오 시각화
- M1/M2/M3 개선율 조정 → 실시간 곡선 업데이트  
- 현재 vs 개선 후 곡선 비교 (파란색: 현재, 주황색: 개선 후)  
- ΔAURC(곡선 면적 차이)로 평균 유지기간 증가량 계산  
- ΔAURC ≥ **1.3** → 실험 진행 (Go)  
- ΔAURC < **1.3** → 보류 (Hold)

---

## ⚙️ 실행 방법

```bash
pip install -r requirements.txt
streamlit run aurc_calc_v3_spill_toggle.py
```

브라우저에서 [http://localhost:8501](http://localhost:8501) 접속

---

## 📊 예시 해석

| 항목 | 예시 | 의미 |
|------|------|------|
| DM≤1 이탈률 | 42% | 첫달 이탈 높음 (온보딩 문제) |
| AURC | 6.07 | 평균 유지기간 6개월 |
| ΔAURC | +1.8 | 개선 후 평균 +1.8개월 상승 |
| 전이효과 | ON | 앞 구간 개선의 누적효과 반영 |

---

## 🧠 분석 로직 개요

- AURC: Kaplan–Meier 생존곡선 면적 (Retention Curve Area)  
- ΔAURC: 개선 전후 생존곡선 면적 차이  
- 전이효과 ON:  
  - `S_scn = hazards_to_survival(h_imp)`  
  - 앞 구간 개선 시 뒤 구간 분모(S(t-1))까지 반영  
- 전이효과 OFF:  
  - `tob_M* = cur_M* × (1 - 개선율%)`  
  - 구간별 독립 계산, 0% 개선 시 현재값과 일치

---

## 💡 트러블슈팅 요약

| 문제 | 원인 | 해결 |
|------|------|------|
| M1 현재값 ≠ TO-BE | DM 집계 vs KM 모델 기준 차이 | OFF 모드에서 cur_M* 기준으로 보정 |
| 15/5/5 시나리오에서 M2 이탈률 ↑ | 전이효과로 M2 진입자 증가 | ON 모드에서 자연스러운 누적 효과로 표시 |
| 사용자 혼란 | 개념 이해 어려움 | Expander 설명문 및 직관적 문구 추가 |
| 설명 복잡도 | 문서 내 가이드 부족 | 전이효과 Expander 내 표 + 요약 설명 추가 |

---

## 👥 담당자
- 데이터 분석팀: **천우석**  
- 프로젝트: *고객 이탈 예측 & AURC 계산기 개발*  
- 문의: `pebble@onuii.com`

---

이 버전은 “구간별 KPI와 전체 유지력 분석을 하나의 대시보드에서 동시에 볼 수 있는 첫 버전”입니다.  
**전이효과(Spillover) 토글**을 통해,  
팀별 목표 관리와 전사 시나리오 비교를 자유롭게 전환하며 분석할 수 있습니다. 🚀
