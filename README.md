# 🧭 AURC & 이탈률 계산기 (ver.2)

## 🎯 목적
고객(학생)의 **이탈 시점과 잔존 유지력**을 분석하여,  
“어디서 가장 많이 이탈하는가?”  
“어디를 개선하면 유지력이 늘어나는가?”  
를 시각적으로 확인하는 대시보드입니다.

---

## ⚙️ 1. 사용법

### ① CSV 업로드

- 분석할 데이터를 CSV로 업로드합니다.
- **필수 컬럼 (7개)**  
  | 컬럼명 | 설명 |
  |--------|------|
  | `lecture_vt_No` | 과외/수업 ID |
  | `fst_pay_date` | 첫 결제일 |
  | `tutoring_state` | 과외 상태 (`finish`, `auto_finish`, `done` → 종료) |
  | `done_month` | 종료까지의 개월 수 |
  | `step` | 단계 코드 (G01~G04) |
  | `reactiveornot` | 반응 여부 (“T” 제외 분석) |
  | `cycle_count` | 회차 수 |

> ⚙️ 선택 컬럼: `fst_months` — 코호트 구분 (1/3/6/12개월)

📘 CSV는 한 번 업로드하면 두 탭(이탈률, AURC)에 자동 공유됩니다.

---

### ② 탭 1 — 이탈률 (Churn Rate)

> **무엇을 보나요?**  
> 구간별(DM 단위) 이탈률과 누적 이탈 비중을 계산합니다.

- `reactiveornot != "T"` 기준으로 활성 고객만 포함  
- **DM별 구간 요약**
  - `DM≤1`: 첫달 이탈률  
  - `DM≤3`: 3개월 내 누적 이탈률  
  - `DM<4`: 4개월 미만 누적 이탈률  

📘 **왜 이렇게 나오나요?**  
각 고객의 `done_month` 값이 해당 구간에 속하면 이탈로 계산되며,  
분모는 전체 활성 고객 수(`reactiveornot != "T"`)입니다.

💡 **해석 팁**  
- `DM≤1`이 높으면 → **초기 온보딩 문제**  
- `DM≤3`이 낮아야 → **안정적 정착 성공**  
- “DM3이하 이탈률”은 **개선 우선순위 구간**으로 활용합니다.

---

### ③ 탭 2 — AURC (KM 기반 생존분석)

> **무엇을 보나요?**  
> 시간(개월/주)에 따라 남아 있는 고객 비율(S(t))을 그린 **생존곡선**을 통해  
> 유지력과 개선 효과(ΔAURC)를 계산합니다.

#### 📈 생존곡선 (전체 & 코호트별)

- Kaplan–Meier(KM) 방식으로 **잔존 확률 S(t)** 계산  
- 코호트별 (1/3/6/12개월) 유지력 비교  
- 마우스 오버 시: 같은 X축에서 여러 곡선의 Y값(잔존률) 동시 표시  

📘 **왜 이렇게 나오나요?**  
KM 방식은 “아직 종료되지 않은 고객”도 반영하여  
생존확률을 점진적으로 추정합니다.  
AURC는 S(t)의 누적 면적이며,  
**값이 클수록 평균 잔존기간이 길다는 뜻**입니다.

---

### 📊 AURC 결과표

| 항목 | 의미 |
|------|------|
| **AURC** | 전체 유지력(잔존 면적, 높을수록 좋음) |
| **ΔAURC** | 개선 시나리오 대비 AURC 증가량 |
| **중위 생존기간** | 잔존율이 50%로 떨어지는 시점 |
| **중단율(%)** | 기간 내 이탈 비중 |

💡 **해석 팁**  
- AURC ↑ → 유지기간 증가  
- ΔAURC ≥ **1.3** → **실험 진행 권장 (Go)**  
- ΔAURC < 1.3 → **효과 미미, 보류 (Hold)**  
- 중위 생존기간 ↑ → 고객 절반 이상이 오래 유지됨  

> 🔎 ΔAURC는 “개선 시나리오 적용 후 평균 유지개월이 얼마나 늘었는가”를 의미합니다.  
> 예를 들어 ΔAURC = +1.8이면, 평균적으로 학생이 **1.8개월 더 유지**된다는 뜻입니다.

---

### ④ 개선 시나리오 (M1/M2/M3)

> **무엇을 하나요?**  
> 초기(M1), 중기(M2), 후기(M3) 구간의 이탈률을 일정 비율 낮췄을 때,  
> 잔존곡선이 얼마나 위로 올라가는지를 시뮬레이션합니다.

- ΔAURC는 “평균 잔존 개월 수 증가”로 해석  
- Hover 시 현재/개선 후 곡선이 한눈에 비교됨  
- 개선 후 선은 점선으로 표시되어 대비 명확  

📘 **왜 이렇게 나오나요?**  
실제 데이터를 수정하지 않고,  
“이탈 확률만 가상으로 조정”해 재계산한 결과이기 때문입니다.  
→ 따라서 시나리오 효과를 **정책 변경 전 미리 예측**할 수 있습니다.

---

## 🎨 색상 가이드 (오누이 CI)

| 용도 | 색상 | 의미 |
|------|------|------|
| 메인 | `#3B82F6` | 기본/현재 상태 |
| 개선 후 | `#10B981` | 시나리오 결과 |
| 경고 | `#EF4444` | 이탈 증가 구간 |
| 보조 | `#F59E0B` | 코호트 3개월 |
| 텍스트 | `#1E3A8A` | 설명/타이틀 |

---

## 📊 예시 해석

| 항목 | 예시 | 의미 |
|------|------|------|
| DM≤1 이탈률 | 42% | 첫달 이탈이 높음 |
| AURC | 6.1 | 평균 유지기간 6개월 |
| ΔAURC | +1.8 | 개선 후 1.8개월 상승 |
| 중위 생존기간 | 5.5개월 | 절반 이상이 5개월 이상 유지 |

💡 *곡선이 급하게 내려갈수록 이탈이 많고, 완만할수록 잔존율이 높습니다.*

---

## 🧠 왜 이렇게 계산되나요?

- KM 곡선은 **검열 데이터(아직 종료되지 않은 고객)** 도 고려합니다.  
- ΔAURC는 “현재 vs 개선 후 곡선 면적 차이”이며,  
  AURC 값이 0.8 증가하면 평균 유지기간이 약 0.8개월 늘어난다고 해석할 수 있습니다.  
- 모든 계산은 `fst_pay_date` 기준으로 필터링되어,  
  특정 기간 내 유입된 고객만 반영됩니다.

---

## 🧩 실행 방법 요약

```bash
pip install -r requirements.txt
streamlit run aurc_calc.py
```

→ 브라우저에서 [http://localhost:8501](http://localhost:8501) 접속

---

## 👥 담당자

- 데이터 분석팀: **천우석**  
- 프로젝트: *고객 이탈 예측 & AURC 계산기 개발*  
- 문의: `pebble@onuii.com`
